<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Remote-home GUI</title>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css" />
<link rel="stylesheet" href="brute-select.css" />
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.js"></script>
<script src="brute-select.js"></script>
<link rel="stylesheet" href="http://jqueryui.com/resources/demos/style.css" />
<script>
var addTabJs = null;
$(function() {
  var tabs = $( "#tabs" ).tabs();
  var tabCounter = 2;
  $( document ).tooltip();
  $( "#type").bruteSelect();
  $( "input[type=submit], a, button" ).button();
  $('tbody tr').hover(function() { $(this).toggleClass('ui-state-highlight'); });
  $("#addDeviceForm").submit(function(event) {
  event.preventDefault();    
  if ($(this).valid()) {
   $("#addDeviceResult").html('');
   var values = $(this).serialize();
    $.ajax({
      url: "",
      'cache' : false,
      type: "get",
      data: values,
      success: function(data){
           $("#addDeviceResult").html(data);
           $("#addDeviceForm").each(function(){ this.reset();});
      },
      error:function(){
          $("#addDeviceResult").html('Error when tried to add the device.');
      }   
    });
  }
  });
  $("#addRoomForm").submit(function(event) {
  event.preventDefault();
  if ($(this).valid()) {
   $("#addRoomResult").html('');
   var values = $(this).serialize();
    $.ajax({
      url: "",
      'cache' : false,
      type: "get",
      data: values,
      success: function(data){
           //$("#addRoomResult").html(data);
           //addTab($("#roomName").val());
           //$("#addRoomForm").each(function(){ this.reset();});
           window.location.reload(true);
      },
      error:function(){
          $("#addRoomResult").html('Error when tried to add the room.');
      }   
    });
  }
  });
  $("#changeChannelPassowrd").submit(function(event) {
  event.preventDefault();
  if ($(this).valid()) {
   $("#changeChannelPassowrdResult").html('');
   var values = $(this).serialize();
    $.ajax({
      url: "",
      'cache' : false,
      type: "get",
      data: values,
      success: function(data){
           $("#changeChannelPassowrdResult").html(data);
      },
      error:function(){
          $("#changeChannelPassowrdResult").html('Error when tried to change the channel / password.');
      }   
    });
  }
  });
  $("#deviceIdLoader").click(function(){  
    $.ajax({
      url: "",
      'cache' : false,
      type: "get",
      data: "ServiceName=GetFreeDeviceId&"+Math.floor((Math.random()*100)+1),
      success: function(freeId) {
          document.getElementById("addDeviceId").value = freeId;
      },
      error:function(){
          alert('Error when tried to get the free device id.');
      }   
    });
  });
  function addTab(label) {
    id = "tabs-" + tabCounter,
    li = "<li><a href='?ServiceName=LoadRoomPage&room="+encodeURIComponent(label)+"'>"+label+"</a></li>",
    tabs.find( ".ui-tabs-nav" ).append( li );
    tabs.tabs( "refresh" );
    //update radios
    $('#addDeviceLocation').append('<option value="'+label+'">'+label+'</option>');
    tabCounter++;
  }
  addTabJs = addTab;
  $( "#tabs" ).tabs({      
      beforeLoad: function( event, ui ) {        
          ui.jqXHR.error(function() {          
              ui.panel.html("Couldn't load this tab." );
          });
      }
  });
  $("#accordion").accordion({
            active: false,
            autoHeight: true,
            navigation: true,
            collapsible: true
  });
  jQuery.validator.addMethod("exactlength", function(value, element, param) { return this.optional(element) || value.length == param; },
    jQuery.format("Please enter exactly {0} characters."));
});
$(document).ready(function(){
  $("#addDeviceForm").validate({
    rules: {
     addDeviceId : { required : true, range: [1, 255] },
     addDeviceName : { required : true },
     type : { required : true },
     roomName : { required : true }
    },
    messages: {
        addDeviceId : { required : "Please enter some device Id.", range: "Your device ID should be in the range 1..255."},
        addDeviceName : { required : "Please enter some device name." },
        type : { required : "Please enter the type of the device." },
        roomName : { required : "Please select the room, where the device is placed." }
    }
  });
  $("#addRoomForm").validate({
    rules: {
     roomName : { required : true }
    },
    messages: {
        addDeviceId : { required : "Please enter the room name."}        
    }
  });
  $("#changeChannelPassowrd").validate({
    rules: {
     channel : { required : true, range: [1, 83] },
     password : { required : true, exactlength : 5 }
    },
    messages: {
        channel : { required : "Please enter the channel.", range : "The radio has 83 channels, the range is 1 - 83." },
        password : { required : "Please enter the password.", exactlength : "The password should have exactly 5 characters." }
    }
  });
  $.ajax({
      url: "",
      type: "get",
      'cache' : false,
      data: "ServiceName=LoadAllRooms&"+Math.floor((Math.random()*100)+1),
      success: function(roomsData) {
           rooms = roomsData.split("\n");
           for (var i=0; i<rooms.length; i++) {
               addTabJs(rooms[i]);
           }
           $('#addDeviceLocation').bruteSelect();
      },
      error:function(){
          alert('Error when tried to get the list of rooms.');
      }   
  });
  $.ajax({
      url: "",
      'cache' : false,
      type: "get",
      data: "ServiceName=LoadChannelPassword&"+Math.floor((Math.random()*100)+1),
      success: function(data) {
           document.getElementById("channel").value = data.split("\n")[0];
           document.getElementById("password").value = data.split("\n")[1];
      },
      error:function(){
          alert('Error when tried to get the channel password.');
      }   
  });
});
</script>
</head>
<body>
<div id="tabs">
<ul>
<li><a href="#tabs-1">System management</a></li>
</ul>
<div id="tabs-1">
<div id="accordion">
<h3>Add new device</h3>
    <div>    
        <p>Here you can add new device. Please note that the only <b>one</b> new device (with id = 0) should be powered on.</p>
        <form id="addDeviceForm">
           <input type="hidden" name="ServiceName" value="AddNewDevice"/>
           <table>
           <tr>
           <td><label for="addDeviceId">New device ID:</label></td><td><input name="addDeviceId" id="addDeviceId" title="The new device ID should not exist in the system."/></td><td><button id="deviceIdLoader">Get available ID</button></td>
           </tr><tr>
           <td><label for="addDeviceName">New device name:</label></td><td><input name="addDeviceName" id="addDeviceName" title="Identifier, which represents the device."/></td><td>&nbsp;</td>
           </tr><tr><td><label for="addDeviceLocation">Room name:</label></td><td colspan="2">
                   <select name="roomName" id="addDeviceLocation">
                   </select>
           </td></tr><td><label for="type">Type of the device:</label></td><td colspan="2">
               <select name="type" id="type">
                    <option value="1">LightAlarmDevice</option>
                    <option value="2"/>TemperatureSensor</option>
                    <option value="3"/>SimpleSwitch</option>
                    <option value="4"/>HeatingHeader</option>
                    <option value="5"/>BlindsControllerDevice</option>
                    <option value="6"/>Thermostat</option>
                    <option value="7"/>BatteryThermostat</option>
               </select>
           </td></tr><tr><td>&nbsp;</td><td>
           <input type="submit" value="Add new device"/></td><td><div id="addDeviceResult">&nbsp;</div></td>
           </tr></table>
        </form>
    </div>
<h3>Rooms management</h3>
    <div>
        <p>Here you can manage the rooms of your home.</p>
        <form id="addRoomForm">        
        <p><label for="roomName">New room name:</label><input name="roomName" id="roomName" title="The room name to be added."/></p>
           <input type="hidden" name="ServiceName" value="AddRoom"/>
           <input type="submit" value="Add new room"/>
        </form>
        <div id="addRoomResult">&nbsp;</div>        
    </div>
<h3>Channel/Password configuration</h3>
    <div>
        <p>Here you can see and change the settings of the system. Please note, that this should be done only at the beginning of the configuration. If you 
            change the channel or password here, it is done only locally so the already existing devices stop to work. You have to reset the device one by one and 
            assign the device id again. (During the assigning procedure, the device will obtain correct channel and password.)
        </p>
        <form id="changeChannelPassowrd">
            <table><tr>
            <td><label for="channel">Channel:</label></td><td><input name="channel" id="channel" title="The communication channel."/></td>
            </tr>
            <tr>
            <td><label for="password">Password:</label></td><td><input name="password" id="password" title="The password for communication."/></td>
            </tr>
            <tr>
            <td><input type="hidden" name="ServiceName" value="ChangeChannelPwd"/><input type="submit" value="Configure"/></td><td><div id="changeChannelPassowrdResult">&nbsp;</div></td>
            </tr>           
            </table>
        </form>                
    </div>
<h3>Wireless network configuration</h3>
    <div>
        <p>Wifi configuration</p>
            <table class="ui-widget" style="border-collapse: collapse;">
              <thead class="ui-widget-header">
                <tr>
                <th>Title</th>
                <th>Start Date</th>
                <th>End Date</th>
                </tr>
                </thead>
                <tbody class="ui-widget-content">
                <tr>
                <td><span>[title]</span></td>
                <td><span>[start date]</span> </td>
                <td><span>[end date]</span></td>
                </tr>
                <tr>
                <td><span>[title]</span></td>
                <td><span>[start date]</span> </td>
                <td><span>[end date]</span></td>
                </tr>
                </tbody>
                </table>
    </div>
</div>
</div>
</div>    
</body>
</html>