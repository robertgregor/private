<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Remote-home GUI</title>
<link rel="stylesheet" href="jquery-ui-1.10.2.custom.css" />
<link rel="stylesheet" href="style.css" />
<link rel="stylesheet" href="schedulers.css" />
<script src="jquery-1.9.1.js"></script>
<script src="jquery-ui-1.10.2.custom.js"></script>
<script type="text/javascript" src="jquery.validate.js"></script>
<script src="schedulers.js"></script>

<script>
var addTabJs = null;
var mouseDown = 0;
$(function() {
  var tabs = $( "#tabs" ).tabs();
  $( document ).tooltip();
  $( "input[type=submit], a, button" ).button();
  $('tbody tr').hover(function() { $(this).toggleClass('ui-state-highlight'); });
  function addTab(label) {
    li = "<li><a href='?ServiceName=LoadRoomPage&room="+encodeURIComponent(label)+"&"+Math.floor((Math.random()*100)+1)+"'>"+label+"</a></li>",
    tabs.find( ".ui-tabs-nav" ).append( li );
    tabs.tabs( "refresh" );
  }
  addTabJs = addTab;
  $( "#tabs" ).tabs({      
      beforeLoad: function( event, ui ) {        
          ui.jqXHR.error(function() {          
              ui.panel.html("Couldn't load this tab." );
          });
      }
  });
  jQuery.validator.addMethod("exactlength", function(value, element, param) { return this.optional(element) || value.length == param; },
  jQuery.format("Please enter exactly {0} characters."));
  $('body').append('<div id="ajaxBusy"></div>');
  $(document).ajaxStart(function () {
    $('#ajaxBusy').show();
  }).ajaxStop(function () {
    $('#ajaxBusy').hide();
  });
});
$(document).ready(function(){
  $.ajax({
      url: "/",
      type: "get",
      'cache' : false,
      data: "ServiceName=LoadAllRooms&"+Math.floor((Math.random()*100)+1),
      success: function(roomsData) {
           rooms = roomsData.split("\n");
           for (var i=0; i<rooms.length; i++) {
               if (rooms[i].length > 1) {
                    addTabJs(rooms[i]);
               }
           }
           $( "#tabs" ).find( ".ui-tabs-nav" ).append( "<li><a href='systemManagement.html'>System management</a></li>" );
           $( "#tabs" ).tabs( "refresh" );
           $("#tabs").tabs("option", {"active": 0});
      },
      error:function(){
          alert('Error when tried to get the list of rooms.');
      }   
  });
});
</script>
</head>
<body>
<div id="tabs">
<ul>
</ul>
</div>
</body>
</html>